function docReady(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,1):document.addEventListener("DOMContentLoaded",e)}async function postData(e="",t={},n=""){const a=document.querySelector("[name=csrfmiddlewaretoken]").value;return(await fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"X-CSRFToken":a,"Content-Type":"application/json",operation:n},body:JSON.stringify(t)})).json()}const cfgFlatpickr={enableTime:!0,dateFormat:"d.m.y H:i",time_24hr:!0,locale:"ru"};window.onclick=function(e){if(!e.target.closest(".dropdown-btn")){const e=document.querySelectorAll(".dropdown-menu");for(let t=0;t<e.length;t++)e[t].classList.contains("is-showing")&&e[t].classList.remove("is-showing")}};const showPagination=(e,t,n)=>{const a=null===t?1:t.numPages;e-=1,document.querySelector(".pagination").innerHTML="";const o=new DocumentFragment;if(a>1){let d,l;t.hasPrevious&&((l=document.createElement("a")).href="#",l.innerHTML="&laquo",l.dataset.page=t.previousPageNumber,o.appendChild(l)),e<=n?d=0:(d=e>n?n-2:n,d=a>e+n?e-d:a-(2*d+1),(l=document.createElement("a")).href="#",l.innerText=1,l.dataset.page=1,o.appendChild(l),(l=document.createElement("span")).innerHTML="...",o.appendChild(l));let r;for(r=e<=n?d+2*n-1:d+n+2,e>a-n-2&&(d=a-9<0?0:a-9,r+=2);d<r&&d<a;)(l=document.createElement("a")).href="#",l.innerText=d+1,0===e&&0===d?l.classList.add("active"):e===d&&l.classList.add("active"),l.dataset.page=d+1,o.appendChild(l),d++;a>r+2&&((l=document.createElement("span")).innerHTML="...",o.appendChild(l),(l=document.createElement("a")).href="#",l.innerText=a,l.dataset.page=t.numPages,o.appendChild(l)),t.hasNext&&((l=document.createElement("a")).href="#",l.innerHTML="&raquo",l.dataset.page=t.nextPageNumber,o.appendChild(l)),document.querySelector(".pagination").appendChild(o)}},openAuxiliaryModal=(e,t=null)=>{let n,a=null;switch(e){case"departments":case"modal-department":n="отдел",document.querySelector("#modal-new-department-name").innerHTML="",document.querySelector("#modal-new-department-short-name").innerHTML="",a="modal-department-add";break;case"locations":case"modal-location":n="расположение",document.querySelector("#modal-department-for-new-location").value=0,document.querySelector("#modal-new-location-office").innerHTML="",document.querySelector("#modal-new-location-phone").innerHTML="",document.querySelector("#modal-new-location-building").value=0,a="modal-location-add";break;case"employees":case"modal-employee":case"modal-customer-in":case"modal-customer-out":n="сотрудника",document.querySelector("#modal-new-lname").innerHTML="",document.querySelector("#modal-new-fname").innerHTML="",document.querySelector("#modal-new-pname").innerHTML="",document.querySelector("#modal-department-for-new-employee").value=0,a="modal-employee-add";break;case"equipment":case"modal-equipment-model":n="наименование техники",document.querySelector("#modal-new-equipment-type-id").value=0,document.querySelector("#modal-new-equipment-brand").value=0,document.querySelector("#modal-new-equipment-model").innerHTML="",a="modal-equipment-model-add";break;case"type_of_equipment":case"modal-equipment-type":n="тип техники",document.querySelector("#modal-new-equipment-type").innerHTML="",a="modal-equipment-type-add";break;case"buildings":n="филиал",document.querySelector("#modal-new-building").innerHTML="",document.querySelector("#modal-new-building-short-name").innerHTML="",a="modal-building-add";break;case"brands":case"modal-equipment-brand":n="филиал",document.querySelector("#modal-new-brand").innerHTML="",document.querySelector("#modal-new-brand-short-name").innerHTML="",a="modal-brand-add"}if(null!==a){let e=`#${a} .modal-header h4`,o=document.querySelector(e);n=null===t?`Добавить ${n}`:`Изменить ${n}(#${t})`,o.innerText=n,modal.open("modal-auxiliary"),modalDisplay(a)}},getAuxiliaryForm=e=>{let t;switch(e){case"modal-department-add":t={table:"departments",vars:{name:document.querySelector("#modal-new-department-name").value,short_name:document.querySelector("#modal-new-department-short-name").value}};break;case"modal-location-add":t={table:"locations",vars:{department_id:document.querySelector("#modal-department-for-new-location").value,office:document.querySelector("#modal-new-location-office").value,building_id:document.querySelector("#modal-new-location-building").value,phone:document.querySelector("#modal-new-location-phone").value}};break;case"modal-employee-add":t={table:"employees",vars:{l_name:document.querySelector("#modal-new-lname").value,f_name:document.querySelector("#modal-new-fname").value,patronymic:document.querySelector("#modal-new-pname").value,department_id:document.querySelector("#modal-department-for-new-employee").value}};break;case"modal-equipment-model-add":t={table:"equipment",vars:{type_id:document.querySelector("#modal-new-equipment-type-id").value,brand_id:document.querySelector("#modal-new-equipment-brand").value,model:document.querySelector("#modal-new-equipment-model").value}};break;case"modal-equipment-type-add":t={table:"type_of_equipment",vars:{name:document.querySelector("#modal-new-equipment-type").value}};break;case"modal-building-add":t={table:"buildings",vars:{name:document.querySelector("#modal-new-building").value,short_name:document.querySelector("#modal-new-building-short-name").value}};break;case"modal-brand-add":t={table:"brands",vars:{name:document.querySelector("#modal-new-brand").value,short_name:document.querySelector("#modal-new-brand-short-name").value}}}return t},modalDisplay=e=>{Array.from(document.querySelector(".modal-auxiliary .modal-content").children).forEach((t,n)=>{t.id===e?t.style.display="block":t.style.display="none"})},infoBlock=(e,t,n=null)=>{const a=new DocumentFragment,o=document.createElement("span");o.innerHTML="&#10006;",o.addEventListener("click",e=>{e.stopPropagation(),e.target.parentNode.parentNode.removeChild(e.target.parentNode)}),null!==n&&setTimeout(function(){o.parentNode.parentNode&&o.parentNode.parentNode.removeChild(o.parentNode)},n);const d=document.createElement("li");d.classList.add("flash",`flash-${e}`),d.innerHTML=t,d.insertBefore(o,d.childNodes[0]);const l=document.querySelector("#info-block");if(document.contains(l))a.appendChild(d),l.appendChild(a);else{const e=document.createElement("ul");e.id="info-block",e.appendChild(d),a.appendChild(e);const t=document.querySelector("main.conteiner").firstChild;document.querySelector("main.conteiner").insertBefore(a,t)}return this.clear=(()=>{document.querySelector("#info-block").innerHTML=""}),this},addTimeZone=(e,t=!1,n=!1)=>{if(""===e||null===e)return"";if(d=new Date(e),d.setTime(d.getTime()+6e4*-d.getTimezoneOffset()),!t)return d;const a=d.getDate()<10?`0${d.getDate()}`:d.getDate(),o=d.getMonth()<9?`0${d.getMonth()+1}`:d.getMonth()+1;if(n)return`${a}.${o}.${d.getFullYear()}`;const l=d.getHours()<10?`0${d.getHours()}`:d.getHours(),r=d.getMinutes()<10?`0${d.getMinutes()}`:d.getMinutes();return`${a}.${o}.${d.getFullYear()} ${l}:${r}`},modal={modals:document.querySelectorAll(".modal"),initial:function(){this.modals.forEach(e=>{let t=e.getAttribute("id");e.querySelectorAll(`[data-target=${t}]`).forEach(t=>{t.addEventListener("click",()=>{e.classList.remove("open-modal"),setTimeout(()=>{e.style.display="none"},400)})})})},open:function(e){document.getElementById(e).style.display="block",setTimeout(()=>{document.getElementById(e).classList.add("open-modal")},0)},close:function(e){document.getElementById(e).classList.remove("open-modal"),setTimeout(()=>{document.getElementById(e).style.display="none"},400)}};docReady(function(){feather.replace(),flatpickr(".flatpickr",cfgFlatpickr),document.querySelectorAll(".dropdown-btn").forEach((e,t)=>{let n=e.getAttribute("id");e.addEventListener("click",()=>{document.querySelector(`[data-target=${n}]`).classList.toggle("is-showing")})}),modal.initial(),document.querySelector("#nav-menu")&&document.querySelector("#nav-menu").addEventListener("click",function(){let e=document.querySelector("#topnavbar");e.classList.contains("responsive")?(e.classList.remove("responsive"),e.querySelectorAll("a svg.feather.feather-x")[0].innerHTML=feather.icons.menu.toSvg()):(e.classList.add("responsive"),e.querySelectorAll("a svg.feather.feather-menu")[0].innerHTML=feather.icons.x.toSvg())})});