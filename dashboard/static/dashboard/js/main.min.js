function docReady(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,1):document.addEventListener("DOMContentLoaded",e)}async function postData(e="",n={},t=""){const a=document.querySelector("[name=csrfmiddlewaretoken]").value;return(await fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"X-CSRFToken":a,"Content-Type":"application/json",operation:t},body:JSON.stringify(n)})).json()}const cfgFlatpickr={enableTime:!0,dateFormat:"d.m.y H:i",time_24hr:!0,locale:"ru"};window.onclick=function(e){if(!e.target.closest(".dropdown-btn")){const e=document.querySelectorAll(".dropdown-menu");for(let n=0;n<e.length;n++)e[n].classList.contains("is-showing")&&e[n].classList.remove("is-showing")}};const showPagination=(e,n,t)=>{const a=null===n?1:n.numPages;e-=1,document.querySelector(".pagination").innerHTML="";const o=new DocumentFragment;if(a>1){let d,l;n.hasPrevious&&((l=document.createElement("a")).href="#",l.innerHTML="&laquo",l.dataset.page=n.previousPageNumber,o.appendChild(l)),e<=t?d=0:(d=e>t?t-2:t,d=a>e+t?e-d:a-(2*d+1),(l=document.createElement("a")).href="#",l.innerText=1,l.dataset.page=1,o.appendChild(l),(l=document.createElement("span")).innerHTML="...",o.appendChild(l));let r;for(r=e<=t?d+2*t-1:d+t+2,e>a-t-2&&(d=a-9<0?0:a-9,r+=2);d<r&&d<a;)(l=document.createElement("a")).href="#",l.innerText=d+1,0===e&&0===d?l.classList.add("active"):e===d&&l.classList.add("active"),l.dataset.page=d+1,o.appendChild(l),d++;a>r+2&&((l=document.createElement("span")).innerHTML="...",o.appendChild(l),(l=document.createElement("a")).href="#",l.innerText=a,l.dataset.page=n.numPages,o.appendChild(l)),n.hasNext&&((l=document.createElement("a")).href="#",l.innerHTML="&raquo",l.dataset.page=n.nextPageNumber,o.appendChild(l)),document.querySelector(".pagination").appendChild(o)}},openAuxiliaryModal=(e,n=null)=>{let t,a=null;switch(e){case"departments":case"modal-department":t="отдел",document.querySelector("#modal-new-department-name").innerHTML="",document.querySelector("#modal-new-department-short-name").innerHTML="",a="modal-department-add";break;case"locations":case"modal-location":t="расположение",document.querySelector("#modal-department-for-new-location").value=0,document.querySelector("#modal-new-location-office").innerHTML="",document.querySelector("#modal-new-location-phone").innerHTML="",document.querySelector("#modal-new-location-building").value=0,a="modal-location-add";break;case"employees":case"modal-employee":case"modal-customer-in":case"modal-customer-out":t="сотрудника",document.querySelector("#modal-new-lname").innerHTML="",document.querySelector("#modal-new-fname").innerHTML="",document.querySelector("#modal-new-pname").innerHTML="",document.querySelector("#modal-department-for-new-employee").value=0,a="modal-employee-add";break;case"equipment":case"modal-equipment-model":t="наименование техники",document.querySelector("#modal-new-equipment-type-id").value=0,document.querySelector("#modal-new-equipment-brand").value=0,document.querySelector("#modal-new-equipment-model").innerHTML="",a="modal-equipment-model-add";break;case"type_of_equipment":case"modal-equipment-type":t="тип техники",document.querySelector("#modal-new-equipment-type").innerHTML="",a="modal-equipment-type-add";break;case"buildings":t="филиал",document.querySelector("#modal-new-building").innerHTML="",document.querySelector("#modal-new-building-short-name").innerHTML="",a="modal-building-add";break;case"brands":case"modal-equipment-brand":t="филиал",document.querySelector("#modal-new-brand").innerHTML="",document.querySelector("#modal-new-brand-short-name").innerHTML="",a="modal-brand-add"}if(null!==a){let e=`#${a} .modal-header h4`,o=document.querySelector(e);t=null===n?`Добавить ${t}`:`Изменить ${t}(#${n})`,o.innerText=t,modal.open("modal-auxiliary"),modalDisplay(a)}},getAuxiliaryForm=e=>{let n;switch(e){case"modal-department-add":n={table:"departments",vars:{name:document.querySelector("#modal-new-department-name").value,short_name:document.querySelector("#modal-new-department-short-name").value}};break;case"modal-location-add":n={table:"locations",vars:{department_id:document.querySelector("#modal-department-for-new-location").value,office:document.querySelector("#modal-new-location-office").value,building_id:document.querySelector("#modal-new-location-building").value,phone:document.querySelector("#modal-new-location-phone").value}};break;case"modal-employee-add":n={table:"employees",vars:{l_name:document.querySelector("#modal-new-lname").value,f_name:document.querySelector("#modal-new-fname").value,patronymic:document.querySelector("#modal-new-pname").value,department_id:document.querySelector("#modal-department-for-new-employee").value}};break;case"modal-equipment-model-add":n={table:"equipment",vars:{type_id:document.querySelector("#modal-new-equipment-type-id").value,brand_id:document.querySelector("#modal-new-equipment-brand").value,model:document.querySelector("#modal-new-equipment-model").value}};break;case"modal-equipment-type-add":n={table:"type_of_equipment",vars:{name:document.querySelector("#modal-new-equipment-type").value}};break;case"modal-building-add":n={table:"buildings",vars:{name:document.querySelector("#modal-new-building").value,short_name:document.querySelector("#modal-new-building-short-name").value}};break;case"modal-brand-add":n={table:"brands",vars:{name:document.querySelector("#modal-new-brand").value,short_name:document.querySelector("#modal-new-brand-short-name").value}}}return n},modalDisplay=e=>{Array.from(document.querySelector(".modal-auxiliary .modal-content").children).forEach((n,t)=>{n.id===e?n.style.display="block":n.style.display="none"})},infoBlock=(e,n,t=null)=>{const a=new DocumentFragment,o=document.createElement("span");o.innerHTML="x",o.addEventListener("click",e=>{e.stopPropagation(),e.target.parentNode.parentNode.removeChild(e.target.parentNode)}),null!==t&&setTimeout(function(){o.parentNode.parentNode&&o.parentNode.parentNode.removeChild(o.parentNode)},t);const d=document.createElement("li");d.classList.add("flash",`flash-${e}`),d.innerHTML=n,d.appendChild(o);const l=document.querySelector("#info-block");if(document.contains(l))a.appendChild(d),l.appendChild(a);else{const e=document.createElement("ul");e.id="info-block",e.appendChild(d),a.appendChild(e);const n=document.querySelector("main.conteiner").firstChild;document.querySelector("main.conteiner").insertBefore(a,n)}return this.clear=(()=>{document.querySelector("#info-block").innerHTML=""}),this},addTimeZone=(e,n=!1)=>(d=new Date(e),d.setTime(d.getTime()+6e4*-d.getTimezoneOffset()),n?`${d.getDate()}.${d.getMonth()+1}.${d.getFullYear()} ${d.getHours()}:${d.getMinutes()}`:d),modal={modals:document.querySelectorAll(".modal"),initial:function(){this.modals.forEach(e=>{let n=e.getAttribute("id");e.querySelectorAll(`[data-target=${n}]`).forEach(n=>{n.addEventListener("click",()=>{e.classList.remove("open-modal"),setTimeout(()=>{e.style.display="none"},400)})})})},open:function(e){document.getElementById(e).style.display="block",setTimeout(()=>{document.getElementById(e).classList.add("open-modal")},0)},close:function(e){document.getElementById(e).classList.remove("open-modal"),setTimeout(()=>{document.getElementById(e).style.display="none"},400)}};docReady(function(){feather.replace(),flatpickr(".flatpickr",cfgFlatpickr),document.querySelectorAll(".dropdown-btn").forEach((e,n)=>{let t=e.getAttribute("id");e.addEventListener("click",()=>{document.querySelector(`[data-target=${t}]`).classList.toggle("is-showing")})}),modal.initial(),document.querySelector("#nav-menu")&&document.querySelector("#nav-menu").addEventListener("click",function(){let e=document.querySelector("#topnavbar");e.classList.contains("responsive")?(e.classList.remove("responsive"),e.querySelectorAll("a svg.feather.feather-x")[0].innerHTML=feather.icons.menu.toSvg()):(e.classList.add("responsive"),e.querySelectorAll("a svg.feather.feather-menu")[0].innerHTML=feather.icons.x.toSvg())})});